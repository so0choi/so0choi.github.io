<!DOCTYPE html><html lang="ko" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>[AWS] SQS batch item failures | StudyYeong</title><meta name="author" content="Soyeong Choi"><meta name="copyright" content="Soyeong Choi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Snowball anti-patternsSQS에서 실패 처리된 메세지 핸들링은 매우 중요하다. 보통의 경우 Lambda가 batch를 처리하다 에러가 발생하는 경우 전체 메세지가 큐에 다시 들어가게 된다. 예를 들어 배치 크기가 100인 경우 한 번에 100개의 메세지가 처리되는 건데 77번째 메세지 처리 중 에러가 발생 할 경우 성공적으로 처리된 메세지를">
<meta property="og:type" content="article">
<meta property="og:title" content="[AWS] SQS batch item failures">
<meta property="og:url" content="https://so0choi.github.io/2023/05/23/AWS/SQS-batch-item-failures/index.html">
<meta property="og:site_name" content="StudyYeong">
<meta property="og:description" content="Snowball anti-patternsSQS에서 실패 처리된 메세지 핸들링은 매우 중요하다. 보통의 경우 Lambda가 batch를 처리하다 에러가 발생하는 경우 전체 메세지가 큐에 다시 들어가게 된다. 예를 들어 배치 크기가 100인 경우 한 번에 100개의 메세지가 처리되는 건데 77번째 메세지 처리 중 에러가 발생 할 경우 성공적으로 처리된 메세지를">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://so0choi.github.io/img/avatar.png">
<meta property="article:published_time" content="2023-05-23T02:41:23.000Z">
<meta property="article:modified_time" content="2023-05-23T06:20:11.744Z">
<meta property="article:author" content="Soyeong Choi">
<meta property="article:tag" content="SQS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://so0choi.github.io/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://so0choi.github.io/2023/05/23/AWS/SQS-batch-item-failures/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-560FY9ZC2B"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-560FY9ZC2B')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-560FY9ZC2B', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '복사 성공',
    error: '복사 실패',
    noSupport: '브라우저가 지원되지 않음'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '방금',
    min: '분 전',
    hour: '시간 전',
    day: '일 전',
    month: '달 전'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '더 보기'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '[AWS] SQS batch item failures',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-23 15:20:11'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">글</div><div class="length-num">206</div></a><a href="/tags/"><div class="headline">태그</div><div class="length-num">112</div></a><a href="/categories/"><div class="headline">카테고리</div><div class="length-num">24</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> AWS</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Algorithm</span></a></li><li><a class="site-page child" href="/"><span> Frontend</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/test.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">StudyYeong</span></a><a class="nav-page-title" href="/"><span class="site-name">[AWS] SQS batch item failures</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> AWS</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Algorithm</span></a></li><li><a class="site-page child" href="/"><span> Frontend</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">[AWS] SQS batch item failures</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">작성일</span><time class="post-meta-date-created" datetime="2023-05-23T02:41:23.000Z" title="작성일 2023-05-23 11:41:23">2023-05-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">수정일</span><time class="post-meta-date-updated" datetime="2023-05-23T06:20:11.744Z" title="수정일 2023-05-23 15:20:11">2023-05-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/AWS/">AWS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">조회수:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Snowball-anti-patterns"><a href="#Snowball-anti-patterns" class="headerlink" title="Snowball anti-patterns"></a>Snowball anti-patterns</h2><p>SQS에서 실패 처리된 메세지 핸들링은 매우 중요하다. 보통의 경우 Lambda가 batch를 처리하다 에러가 발생하는 경우 전체 메세지가 큐에 다시 들어가게 된다. 예를 들어 배치 크기가 100인 경우 한 번에 100개의 메세지가 처리되는 건데 77번째 메세지 처리 중 에러가 발생 할 경우 성공적으로 처리된 메세지를 포함한 전체 100개의 메세지가 다시 큐에 나타나게 된다. 결과적으로 같은 메세지가 여러 번 처리될 것이다.</p>
<p>Dead-letter 큐가 있는 경우 실패한 메세지가 그곳으로 이동하겠지만 그렇지 않은경우 source 큐에 계속해서 다시 들어가게 되고 계속적인 메세지 처리 실패 후에는 유효 메세지 수 보다 실패했던 메세지의 수가 많아져 문제가 눈덩이처럼 불어날 것이다. 이 경우 아래와 같은 부가적인 문제들로 이어진다.</p>
<ul>
<li>사용자 경험의 저하: batch 처리에 시간이 오래걸린다. 또는 전혀 처리되지 않을 수도 있다.</li>
<li>사용 비용 증가: SQS 메세지 수 증가와 재시도 수 증가는 비용의 증가로 이어진다.</li>
<li>Lambda 처리 capacity가 줄어든다</li>
</ul>
<h2 id="batch-부분-실패-기능"><a href="#batch-부분-실패-기능" class="headerlink" title="batch 부분 실패 기능"></a>batch 부분 실패 기능</h2><p>이를 방지하기 위해 batch 부분 실패 처리 기능을 사용할 수 있다. 실패 처리 된 메세지만 큐에 다시 보이도록 하는 것이다. 이 설정을 바꾸려면 <code>ReportBatchItemFailures</code> 옵션 설정을 수정해야 한다. 옵션이 활성화 될 경우, Labmda는 실행이 실패하여도 메세지 폴링 크기를 낮추지 않는다.<br>기본적으로 Labmda는 처리에 실패했을 때 실패 원인에 따라 다른 처리 방식을 가지고 있다.</p>
<ul>
<li>Labmda 함수 코드 레벨 에러: 에러가 발생할 경우 SQS 이벤트 소스에 매핑된 동시 처리량을 감소시키면서 Labmda 함수 실행을 재시도한다. 만약 실행이 계속해서 실패한다면 더이상 재시도 하지 않고 메세지를 드랍시킨다.</li>
<li>throttling에 의한 실패: 에러가 발생할 경우 SQS 이벤트 소스에 매핑된 동시 처리량을 감소시키면서 Labmda 함수 실행을 재시도한다. 메시지의 timestamp가 큐의 visibility timeout을 초과하기 전까지 재시도 하며 해당 시점이 지나면 메세지를 드랍시킨다.</li>
</ul>
<p><code>ReportBatchItemFailures</code>를 활성화 하더라도 Labmda가 exception을 뱉는 경우 전체 batch가 실패한 것으로 간주된다. 또한 메세지 처리 순서가 중요한 FIFO 큐를 사용하는 경우 에러가 발생하면 순서가 엉키지 않도록 프로세스를 중단하고 실패한 메세지가 먼저 처리되도록 해야 한다.</p>
<h2 id="ReportBatchItemFailures-적용하기"><a href="#ReportBatchItemFailures-적용하기" class="headerlink" title="ReportBatchItemFailures 적용하기"></a>ReportBatchItemFailures 적용하기</h2><h3 id="Lambda-설정"><a href="#Lambda-설정" class="headerlink" title="Lambda 설정"></a>Lambda 설정</h3><p>먼저 event source mapping의 UUID 값을 알아내야 한다. 터미널에 다음 명령어를 입력한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws lambda list-event-source-mappings --event-source-arn [SQS 큐 arn]    </span><br></pre></td></tr></table></figure>

<p>그럼 아래와 같은 결과가 나올 것이다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;EventSourceMappings&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;UUID&quot;: &quot;a1b2c3d4-5678-90ab-cdef-11111EXAMPLE&quot;,</span><br><span class="line">             ... </span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UUID 값을 복사해놓고 아래 명령어를 입력하면 된다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws lambda update-event-source-mapping \</span><br><span class="line">--uuid &quot;a1b2c3d4-5678-90ab-cdef-11111EXAMPLE&quot; \</span><br><span class="line">--function-response-types &quot;ReportBatchItemFailures&quot;</span><br></pre></td></tr></table></figure>

<h3 id="코드-레벨-설정"><a href="#코드-레벨-설정" class="headerlink" title="코드 레벨 설정"></a>코드 레벨 설정</h3><p>이제 Lambda가 batch 처리 중 실패할 경우 실패한 메세지들만 모아서 반환하도록 해야 한다. 응답은 JSON 형식으로 <code>batchItemFailures</code>가 <code>itemIdentifier</code> 리스트를 가지고 있으면 된다. </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">&quot;batchItemFailures&quot;</span>: [ </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;itemIdentifier&quot;</span>: <span class="string">&quot;id2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;itemIdentifier&quot;</span>: <span class="string">&quot;id4&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="사용-예"><a href="#사용-예" class="headerlink" title="사용 예"></a>사용 예</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; SQSBatchItemFailure, SQSBatchResponse, SQSRecord &#125; <span class="keyword">from</span> <span class="string">&quot;aws-lambda&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BatchItemFailure</span> <span class="title">implements</span> <span class="title">SQSBatchItemFailure</span> </span>&#123;</span><br><span class="line">    <span class="attr">itemIdentifier</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">itemIdentifier: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.itemIdentifier = itemIdentifier;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BatchResponse</span> <span class="title">implements</span> <span class="title">SQSBatchResponse</span> </span>&#123;</span><br><span class="line">    <span class="attr">batchItemFailures</span>: SQSBatchItemFailure[];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">batchItemFailures: SQSBatchItemFailure[]</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.batchItemFailures = batchItemFailures;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">SqsStreamHandler</span> </span>&#123;</span><br><span class="line">    <span class="attr">batchItemFailures</span>: BatchItemFailure[];</span><br><span class="line">    records: SQSRecord[];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">records: SQSRecord[]</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.records = records;</span><br><span class="line">        <span class="built_in">this</span>.batchItemFailures = [];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    handleStreams = <span class="keyword">async</span> (</span><br><span class="line">        cb: <span class="built_in">Function</span>,</span><br><span class="line">      ): <span class="built_in">Promise</span>&lt;BatchResponse&gt; =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> messageId = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> record <span class="keyword">of</span> <span class="built_in">this</span>.records) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                messageId = record.messageId;</span><br><span class="line">                cb(record.body);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.deleteProcessedMessageIdFromDdb(messageId);</span><br><span class="line">                <span class="built_in">this</span>.batchItemFailures.push(<span class="keyword">new</span> BatchItemFailure(messageId));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BatchResponse(<span class="built_in">this</span>.batchItemFailures);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>더 나은 방법도 있을 것 같은데 나는 일단 이런 식으로 만들었다.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>작성자: </span><span class="post-copyright-info"><a href="https://so0choi.github.io">Soyeong Choi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>링크: </span><span class="post-copyright-info"><a href="https://so0choi.github.io/2023/05/23/AWS/SQS-batch-item-failures/">https://so0choi.github.io/2023/05/23/AWS/SQS-batch-item-failures/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>저작권 고지: </span><span class="post-copyright-info">이 블로그의 모든 글은 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 라이선스를 따르며, 별도로 명시되지 않는 한 모든 권리를 보유합니다. 재배포 시 출처를 명시해 주세요: <a href="https://so0choi.github.io">StudyYeong</a>.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQS/">SQS</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2023/06/19/Else/Wowza-Low-latency-hls/" title="Wowza Streaming Engine으로 LL-HLS 스트리밍 하기"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">이전</div><div class="prev_info">Wowza Streaming Engine으로 LL-HLS 스트리밍 하기</div></div></a><a class="next-post pull-right" href="/2023/05/23/AWS/DLQ-%EB%A6%AC%EB%93%9C%EB%9D%BC%EC%9D%B4%EB%B8%8C/" title="[AWS] DLQ(Dead Letter Queue) 리드라이브"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">다음</div><div class="next_info">[AWS] DLQ(Dead Letter Queue) 리드라이브</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>관련 글</span></div><div class="relatedPosts-list"><a href="/2022/04/14/AWS/sqs/" title="SQS Lambda Trigger"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-14</div><div class="title">SQS Lambda Trigger</div></div></a><a href="/2023/05/23/AWS/DLQ-%EB%A6%AC%EB%93%9C%EB%9D%BC%EC%9D%B4%EB%B8%8C/" title="[AWS] DLQ(Dead Letter Queue) 리드라이브"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-23</div><div class="title">[AWS] DLQ(Dead Letter Queue) 리드라이브</div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Soyeong Choi</div><div class="author-info-description">Personal IT Diary</div><div class="site-data"><a href="/archives/"><div class="headline">글</div><div class="length-num">206</div></a><a href="/tags/"><div class="headline">태그</div><div class="length-num">112</div></a><a href="/categories/"><div class="headline">카테고리</div><div class="length-num">24</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/so0choi"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/so0choi" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:simc2644@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>공지</span></div><div class="announcement_content">Life is not all beer and skittles.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>목차</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Snowball-anti-patterns"><span class="toc-number">1.</span> <span class="toc-text">Snowball anti-patterns</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#batch-%EB%B6%80%EB%B6%84-%EC%8B%A4%ED%8C%A8-%EA%B8%B0%EB%8A%A5"><span class="toc-number">2.</span> <span class="toc-text">batch 부분 실패 기능</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReportBatchItemFailures-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0"><span class="toc-number">3.</span> <span class="toc-text">ReportBatchItemFailures 적용하기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lambda-%EC%84%A4%EC%A0%95"><span class="toc-number">3.1.</span> <span class="toc-text">Lambda 설정</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%BD%94%EB%93%9C-%EB%A0%88%EB%B2%A8-%EC%84%A4%EC%A0%95"><span class="toc-number">3.2.</span> <span class="toc-text">코드 레벨 설정</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%82%AC%EC%9A%A9-%EC%98%88"><span class="toc-number">3.3.</span> <span class="toc-text">사용 예</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>최근 글</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/22/Docker/docker-multistage-build/" title="docker_multistage_build">docker_multistage_build</a><time datetime="2025-10-22T01:50:27.000Z" title="작성일 2025-10-22 10:50:27">2025-10-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/09/Else/redis-stream/" title="Redis Stream 알아보기">Redis Stream 알아보기</a><time datetime="2025-09-08T19:29:18.000Z" title="작성일 2025-09-09 04:29:18">2025-09-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/02/Else/verdaccio/" title="verdaccio private npm registry 구축하기">verdaccio private npm registry 구축하기</a><time datetime="2025-04-02T06:05:52.000Z" title="작성일 2025-04-02 15:05:52">2025-04-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/11/Else/rollup/" title="rollup.js">rollup.js</a><time datetime="2025-03-11T01:17:29.000Z" title="작성일 2025-03-11 10:17:29">2025-03-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/02/Nodejs/nodejs-server-performance/" title="NodeJS 구조 및 성능 향상 시키기">NodeJS 구조 및 성능 향상 시키기</a><time datetime="2024-12-02T02:16:50.000Z" title="작성일 2024-12-02 11:16:50">2024-12-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Soyeong Choi</div><div class="framework-info"><span>프레임워크 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>테마 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="읽기 모드"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="라이트/다크 모드 전환"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="단일/이중 열 전환"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="설정"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="목차"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="맨 위로"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>